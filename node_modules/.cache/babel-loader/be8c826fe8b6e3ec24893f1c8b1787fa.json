{"ast":null,"code":"import { FETCH_USER_DETAIL, UPDATE_USER_DETAIL, UPDATE_USER_PROFILE, CHECK_USER_SESSION, REFRESH_USER_TOKEN, UPDATE_AUTH_ID, UPDATE_LOG_STATUS, UPDATE_LOG_INFO, UPDATE_USER_WALLET, USER_LOGOUT, USER_LOGIN } from '../actionTypes';\nimport { sessionService } from 'redux-react-session';\nimport axios from 'axios';\nimport { COOKIE_MAX_AGE } from '../constants';\nexport const userLogin = (credentias, _histroy, setIsSubmitting) => {\n  axios.post(\"https://hi-exchange.com/api/v2/token/verify/\", credentias).then(response => {\n    const {\n      data\n    } = response;\n    const {\n      token,\n      refresh\n    } = data[\"access\"];\n    sessionService.saveSession({\n      token,\n      refresh\n    }).then(e => {\n      axios.get(\"https://hi-exchange.com/api/v2/account/details/\", {\n        headers: {\n          \"Authorization\": \"Bearer \" + token\n        }\n      }).then(data => {\n        sessionService.saveUser(data.data).then(e => {\n          _histroy.push(\"/\");\n        });\n      }).catch(err => {\n        console.log(err);\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }).catch(err => {// toast.error(\"کد وارد شده صحیح نمی باشد.\", toastOpt)\n  }).finally(e => {\n    setIsSubmitting(false);\n  });\n};\nexport const udpate_user_detail = user => {\n  return {\n    type: UPDATE_USER_DETAIL,\n    payload: user\n  };\n};\nexport const udpate_user_profile = profile => {\n  return {\n    type: UPDATE_USER_PROFILE,\n    payload: profile\n  };\n};\nexport const udpate_user_wallet = wallet => {\n  return {\n    type: UPDATE_USER_WALLET,\n    payload: wallet\n  };\n};\nexport const update_auth_id = authID => {\n  return {\n    type: UPDATE_AUTH_ID,\n    payload: authID\n  };\n};\nexport const update_log_status = status => {\n  return {\n    type: UPDATE_LOG_STATUS,\n    payload: status\n  };\n};\nexport const update_log_info = (access, refresh) => {\n  return {\n    type: UPDATE_LOG_INFO,\n    payload: {\n      access,\n      refresh\n    }\n  };\n};\nexport const user_login = (access, refresh) => {\n  return dispatch => {\n    localStorage.setItem(\"hiexchange_token\", access);\n    localStorage.setItem(\"hiexchange_refresh\", refresh);\n    localStorage.setItem(\"hiexchange_refresh_time\", new Date().getTime());\n    dispatch(update_log_status(true));\n    dispatch(update_log_info(access, refresh));\n    dispatch(fetch_user_detail(access)); // dispatch(fetch_user_profile(token));\n  };\n};\nexport const fetch_user_detail = token => {\n  return dispatch => {\n    axios.get(\"https://hi-exchange.com/api/v2/account/details/\", {\n      headers: {\n        \"Authorization\": \"Bearer \" + token\n      }\n    }).then(data => {\n      dispatch(udpate_user_detail(data.data));\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n};\nexport const fetch_user_profile = token => {\n  return dispatch => {\n    axios.post(\"https://hi-exchange.com/api/v2/account/manage/\", {\n      headers: {\n        \"Authorization\": \"Bearer \" + token\n      }\n    }).then(data => {\n      dispatch(udpate_user_profile(data.data));\n    }).catch(error => {\n      console.log(error.response.status);\n    });\n  };\n};\nexport const logout = e => {\n  return {\n    type: USER_LOGOUT\n  };\n};\nexport const check_user_session = isLogged => {\n  return dispatch => {\n    const token = localStorage.getItem(\"hiexchange_token\");\n    const refresh_time = +localStorage.getItem(\"hiexchange_refresh_time\");\n    const refresh = localStorage.getItem(\"hiexchange_refresh\");\n\n    if (token && refresh_time && refresh) {\n      const now = new Date();\n\n      if (now.getTime() - refresh_time > 60 * 30 * 1000) {\n        axios.post(\"https://hi-exchange.com/api/v2/token/refresh/\", {\n          refresh: refresh\n        }).then(data => {\n          dispatch(user_login(data.data.access, refresh));\n        });\n      } else {\n        if (!isLogged) dispatch(user_login(token, refresh));\n      }\n    } else {\n      console.log(\"CAME\");\n      dispatch(logout());\n    }\n  };\n};","map":{"version":3,"sources":["H:/Projects/package/cheerio/src/redux/actions/user.js"],"names":["FETCH_USER_DETAIL","UPDATE_USER_DETAIL","UPDATE_USER_PROFILE","CHECK_USER_SESSION","REFRESH_USER_TOKEN","UPDATE_AUTH_ID","UPDATE_LOG_STATUS","UPDATE_LOG_INFO","UPDATE_USER_WALLET","USER_LOGOUT","USER_LOGIN","sessionService","axios","COOKIE_MAX_AGE","userLogin","credentias","_histroy","setIsSubmitting","post","then","response","data","token","refresh","saveSession","e","get","headers","saveUser","push","catch","err","console","log","finally","udpate_user_detail","user","type","payload","udpate_user_profile","profile","udpate_user_wallet","wallet","update_auth_id","authID","update_log_status","status","update_log_info","access","user_login","dispatch","localStorage","setItem","Date","getTime","fetch_user_detail","fetch_user_profile","error","logout","check_user_session","isLogged","getItem","refresh_time","now"],"mappings":"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","sourcesContent":["import {\r\n    FETCH_USER_DETAIL,\r\n    UPDATE_USER_DETAIL,\r\n    UPDATE_USER_PROFILE,\r\n    CHECK_USER_SESSION,\r\n    REFRESH_USER_TOKEN,\r\n    UPDATE_AUTH_ID,\r\n    UPDATE_LOG_STATUS,\r\n    UPDATE_LOG_INFO,\r\n    UPDATE_USER_WALLET,\r\n    USER_LOGOUT,\r\n    USER_LOGIN\r\n} from '../actionTypes'\r\nimport { sessionService } from 'redux-react-session'\r\nimport axios from 'axios';\r\nimport { COOKIE_MAX_AGE } from '../constants'\r\nexport const userLogin = (credentias, _histroy ,setIsSubmitting)=>{\r\n    axios.post(\"https://hi-exchange.com/api/v2/token/verify/\", credentias)\r\n        .then(response=>{\r\n            const {data} = response\r\n            const {token, refresh} = data[\"access\"];\r\n            sessionService.saveSession({token, refresh}).then(e=>{\r\n                axios.get(\"https://hi-exchange.com/api/v2/account/details/\", {\r\n                    headers: {\r\n                        \"Authorization\": \"Bearer \"+token,\r\n                    }\r\n                }).then(data=>{\r\n                    sessionService.saveUser(data.data).then(e=>{\r\n                        _histroy.push(\"/\");\r\n                    })\r\n                }).catch(err=>{\r\n                    console.log(err);\r\n                })\r\n            }).catch(err=>{\r\n                console.log(err);\r\n            })\r\n        }).catch(err=>{\r\n            // toast.error(\"کد وارد شده صحیح نمی باشد.\", toastOpt)\r\n        }).finally(e=>{\r\n            \r\n            setIsSubmitting(false);\r\n        })\r\n}\r\nexport const udpate_user_detail = (user)=>{\r\n    return {\r\n        type: UPDATE_USER_DETAIL,\r\n        payload: user\r\n    }\r\n}\r\nexport const udpate_user_profile = (profile)=>{\r\n    return {\r\n        type: UPDATE_USER_PROFILE,\r\n        payload: profile\r\n    }\r\n}\r\n\r\nexport const udpate_user_wallet = (wallet)=>{\r\n    return {\r\n        type: UPDATE_USER_WALLET,\r\n        payload: wallet\r\n    }\r\n}\r\nexport const update_auth_id = (authID)=>{\r\n    return {\r\n        type: UPDATE_AUTH_ID,\r\n        payload: authID\r\n    }\r\n}\r\nexport const update_log_status = (status)=>{\r\n    return {\r\n        type: UPDATE_LOG_STATUS,\r\n        payload: status\r\n    }\r\n}\r\nexport const update_log_info = (access, refresh)=>{\r\n    return {\r\n        type: UPDATE_LOG_INFO,\r\n        payload: {access, refresh}\r\n    }\r\n}\r\nexport const user_login = (access, refresh)=>{\r\n    return dispatch=>{\r\n        localStorage.setItem(\"hiexchange_token\", access);\r\n        localStorage.setItem(\"hiexchange_refresh\", refresh);\r\n        localStorage.setItem(\"hiexchange_refresh_time\", new Date().getTime());\r\n        dispatch(update_log_status(true))\r\n        dispatch(update_log_info(access, refresh));\r\n        dispatch(fetch_user_detail(access));\r\n            // dispatch(fetch_user_profile(token));\r\n    }\r\n}\r\nexport const fetch_user_detail = (token)=>{\r\n    return (dispatch) => {\r\n        axios.get(\"https://hi-exchange.com/api/v2/account/details/\", {\r\n            headers: {\r\n                \"Authorization\": \"Bearer \"+token,\r\n            }\r\n        }).then(data=>{\r\n            dispatch(udpate_user_detail(data.data))\r\n        }).catch(err=>{\r\n            console.log(err);\r\n        })\r\n    }\r\n}\r\nexport const fetch_user_profile = (token)=>{\r\n    return (dispatch) => {\r\n        axios.post(\"https://hi-exchange.com/api/v2/account/manage/\", {\r\n            headers: {\r\n                \"Authorization\": \"Bearer \"+token\r\n            }\r\n        }).then(data=>{\r\n            dispatch(udpate_user_profile(data.data))\r\n        }).catch(error=>{\r\n            console.log(error.response.status);\r\n        })\r\n    }\r\n}\r\nexport const logout = e=>{\r\n    return {\r\n        type: USER_LOGOUT\r\n    }\r\n}\r\nexport const check_user_session = (isLogged)=>{\r\n    return dispatch => {\r\n        const token = localStorage.getItem(\"hiexchange_token\");\r\n        const refresh_time = +localStorage.getItem(\"hiexchange_refresh_time\");\r\n        const refresh = localStorage.getItem(\"hiexchange_refresh\");\r\n        if(token && refresh_time && refresh){\r\n            const now = new Date()\r\n            if (now.getTime() - refresh_time > 60*30*1000){\r\n                axios.post(\"https://hi-exchange.com/api/v2/token/refresh/\", {\r\n                    refresh: refresh\r\n                }).then(data=>{\r\n                     dispatch(user_login(data.data.access, refresh));\r\n                }) \r\n            }else{\r\n                if (!isLogged)\r\n                dispatch(user_login(token, refresh));\r\n            }\r\n        }else{\r\n            console.log(\"CAME\")\r\n            dispatch(logout())\r\n        }\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}