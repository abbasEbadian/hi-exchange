{"ast":null,"code":"import { FETCH_USER_DETAIL, UPDATE_USER_DETAIL, UPDATE_USER_PROFILE, CHECK_USER_SESSION, REFRESH_USER_TOKEN, UPDATE_AUTH_ID, UPDATE_LOG_STATUS, UPDATE_LOG_INFO, UPDATE_USER_WALLET } from '../actionTypes';\nimport axios from 'axios';\nimport Cookies from 'universal-cookie';\nimport { COOKIE_MAX_AGE } from '../constants';\nexport const udpate_user_detail = user => {\n  return {\n    type: UPDATE_USER_DETAIL,\n    payload: user\n  };\n};\nexport const udpate_user_profile = profile => {\n  return {\n    type: UPDATE_USER_PROFILE,\n    payload: profile\n  };\n};\nexport const udpate_user_wallet = wallet => {\n  return {\n    type: UPDATE_USER_WALLET,\n    payload: wallet\n  };\n};\nexport const update_auth_id = authID => {\n  return {\n    type: UPDATE_AUTH_ID,\n    payload: authID\n  };\n};\nexport const update_log_status = status => {\n  return {\n    type: UPDATE_LOG_STATUS,\n    payload: status\n  };\n};\nexport const update_log_info = (access, refresh) => {\n  return {\n    type: UPDATE_LOG_INFO,\n    payload: {\n      access,\n      refresh\n    }\n  };\n};\nexport const user_login = (access, refresh) => {\n  return dispatch => {\n    const cookies = new Cookies();\n    console.log(access, refresh);\n    cookies.set(\"hiexchange_token\", access);\n    cookies.set(\"hiexchange_refresh\", refresh);\n    cookies.set(\"hiexchange_refresh_time\", new Date().getTime());\n    dispatch(update_log_status(true));\n    dispatch(update_log_info(access, refresh));\n  };\n};\nexport const fetch_user_detail = token => {\n  return dispatch => {\n    axios.get(\"https://hi-exchange.com/api/v2/account/details/\", {\n      headers: {\n        \"Authorization\": \"Bearer \" + token\n      }\n    }).then(data => {\n      dispatch(udpate_user_detail(data.data));\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n};\nexport const fetch_user_profile = token => {\n  return dispatch => {\n    axios.post(\"https://hi-exchange.com/api/v2/account/manage/\", {\n      headers: {\n        \"Authorization\": \"Bearer \" + token\n      }\n    }).then(data => {\n      dispatch(udpate_user_profile(data.data));\n    }).catch(error => {\n      console.log(error.response.status);\n    });\n  };\n};\nexport const check_user_session = () => {\n  return dispatch => {\n    const cookies = new Cookies();\n    const token = cookies.get(\"hiexchange_token\");\n    const refresh_time = +cookies.get(\"hiexchange_refresh_time\");\n    const refresh = cookies.get(\"hiexchange_refresh\");\n    console.log(\"TOKEN\", token);\n\n    if (token && refresh_time && refresh) {\n      const now = new Date();\n\n      if (now.getTime() - refresh_time > 60 * 30 * 1000) {\n        axios.post(\"https://hi-exchange.com/api/v2/token/refresh/\", {\n          refresh: refresh\n        }).then(data => {\n          cookies.set(\"hiexchange_token\", data.data.access);\n          cookies.set(\"hiexchange_refresh_time\", now.getTime());\n          dispatch(user_login(token, refresh));\n          dispatch(fetch_user_detail(token));\n          dispatch(fetch_user_profile(token));\n        });\n      } else {\n        dispatch(fetch_user_detail(token));\n        dispatch(fetch_user_profile(token));\n      }\n    }\n  };\n};","map":{"version":3,"sources":["H:/Projects/package/cheerio/src/redux/actions/user.js"],"names":["FETCH_USER_DETAIL","UPDATE_USER_DETAIL","UPDATE_USER_PROFILE","CHECK_USER_SESSION","REFRESH_USER_TOKEN","UPDATE_AUTH_ID","UPDATE_LOG_STATUS","UPDATE_LOG_INFO","UPDATE_USER_WALLET","axios","Cookies","COOKIE_MAX_AGE","udpate_user_detail","user","type","payload","udpate_user_profile","profile","udpate_user_wallet","wallet","update_auth_id","authID","update_log_status","status","update_log_info","access","refresh","user_login","dispatch","cookies","console","log","set","Date","getTime","fetch_user_detail","token","get","headers","then","data","catch","err","fetch_user_profile","post","error","response","check_user_session","refresh_time","now"],"mappings":"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","sourcesContent":["import {\r\n    FETCH_USER_DETAIL,\r\n    UPDATE_USER_DETAIL,\r\n    UPDATE_USER_PROFILE,\r\n    CHECK_USER_SESSION,\r\n    REFRESH_USER_TOKEN,\r\n    UPDATE_AUTH_ID,\r\n    UPDATE_LOG_STATUS,\r\n    UPDATE_LOG_INFO,\r\n    UPDATE_USER_WALLET\r\n} from '../actionTypes'\r\nimport axios from 'axios';\r\nimport Cookies from 'universal-cookie';\r\nimport { COOKIE_MAX_AGE } from '../constants'\r\nexport const udpate_user_detail = (user)=>{\r\n    return {\r\n        type: UPDATE_USER_DETAIL,\r\n        payload: user\r\n    }\r\n}\r\nexport const udpate_user_profile = (profile)=>{\r\n    return {\r\n        type: UPDATE_USER_PROFILE,\r\n        payload: profile\r\n    }\r\n}\r\n\r\nexport const udpate_user_wallet = (wallet)=>{\r\n    return {\r\n        type: UPDATE_USER_WALLET,\r\n        payload: wallet\r\n    }\r\n}\r\nexport const update_auth_id = (authID)=>{\r\n    return {\r\n        type: UPDATE_AUTH_ID,\r\n        payload: authID\r\n    }\r\n}\r\nexport const update_log_status = (status)=>{\r\n    return {\r\n        type: UPDATE_LOG_STATUS,\r\n        payload: status\r\n    }\r\n}\r\nexport const update_log_info = (access, refresh)=>{\r\n    return {\r\n        type: UPDATE_LOG_INFO,\r\n        payload: {access, refresh}\r\n    }\r\n}\r\nexport const user_login = (access, refresh)=>{\r\n    return dispatch=>{\r\n        const cookies = new Cookies()\r\n        console.log(access, refresh)\r\n        cookies.set(\"hiexchange_token\", access);\r\n        cookies.set(\"hiexchange_refresh\", refresh);\r\n        cookies.set(\"hiexchange_refresh_time\", new Date().getTime());\r\n        dispatch(update_log_status(true))\r\n        dispatch(update_log_info(access, refresh));\r\n    }\r\n}\r\nexport const fetch_user_detail = (token)=>{\r\n    return (dispatch) => {\r\n        axios.get(\"https://hi-exchange.com/api/v2/account/details/\", {\r\n            headers: {\r\n                \"Authorization\": \"Bearer \"+token,\r\n            }\r\n        }).then(data=>{\r\n            dispatch(udpate_user_detail(data.data))\r\n        }).catch(err=>{\r\n            console.log(err);\r\n        })\r\n    }\r\n}\r\nexport const fetch_user_profile = (token)=>{\r\n    return (dispatch) => {\r\n        axios.post(\"https://hi-exchange.com/api/v2/account/manage/\", {\r\n            headers: {\r\n                \"Authorization\": \"Bearer \"+token\r\n            }\r\n        }).then(data=>{\r\n            dispatch(udpate_user_profile(data.data))\r\n        }).catch(error=>{\r\n            console.log(error.response.status);\r\n        })\r\n    }\r\n}\r\n\r\nexport const check_user_session = ()=>{\r\n    return dispatch => {\r\n        const cookies = new Cookies();\r\n        const token = cookies.get(\"hiexchange_token\");\r\n        const refresh_time = +cookies.get(\"hiexchange_refresh_time\");\r\n        const refresh = cookies.get(\"hiexchange_refresh\");\r\n        console.log(\"TOKEN\", token)\r\n        if(token && refresh_time && refresh){\r\n            const now = new Date()\r\n            if (now.getTime() - refresh_time > 60*30*1000){\r\n                axios.post(\"https://hi-exchange.com/api/v2/token/refresh/\", {\r\n                    refresh: refresh\r\n                }).then(data=>{\r\n                    cookies.set(\"hiexchange_token\", data.data.access);\r\n                    cookies.set(\"hiexchange_refresh_time\", now.getTime());\r\n                    dispatch(user_login(token, refresh));\r\n                    dispatch(fetch_user_detail(token));\r\n                    dispatch(fetch_user_profile(token));\r\n                }) \r\n            }else{\r\n                dispatch(fetch_user_detail(token));\r\n                dispatch(fetch_user_profile(token));\r\n            }\r\n        }\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}